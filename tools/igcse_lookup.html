<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cambridge IGCSE ä¸­æ–‡æˆè¯­è¯å…¸</title>

  <!-- Bootstrap 5 CDN -->
  <link href="./assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="./assets/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">

  <style>
  /* åŸºç¡€é‡ç½® */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
    background-color:#fafafa;
    color: #333;
    line-height: 1.6;
  }

.card-chinese{
    margin:0 auto;
    background-color:#d9f3ea;
    border-width:18px 18px;
    border-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAACQBAMAAAAVaP+LAAAAKlBMVEUlTjyLkYMlTjyusqeLkYOQloeMk4Ssr6Srr6Orr6OQloeMk4Susqesr6S4aju3AAAADnRSTlP/PABYDhAPHFQcPz0eVXg9TJUAAAI+SURBVHgB7ZnBbdtAEEW3hWUHGmyUKMktHSyoQ66BKshB6SB3uQTDFbgEl6CzT67I5hCfGGEGXJqksTS5D8hgIi0exPn0ili5WyoicgMgtW7dIt8Bkb/hlz+eT7UEIvEKPgWzg6iiXgJEsXuliDKIdp7h4Kv3xh+lyE1gO6Ju2IRhtwPlYf8/NQM2h61ElRk/ekQueyhyiIoIwev4lSjo+FF7sEQuzQpFSEfWdvC2yBg2Y4hwK9iiaMTf8ElEd0TfRL/kSyMpQp1NBIMCIvTMAf+/R2+SFgX1nbF4kd7Y/MW3Is9AhC0ttv1v/JWh6q2WQS/BfSR71HyiIkL8DbaoDRvx94gEtkiwTZH38iFCi+RDBDBEQPQ2YaKoiGhpIklaJNiSyHdcfErUbmwtxn00ivARokei71ynip6IfnAdw0/nrlw70ctkES5tMcNGEzOLvjj3h6vDsK40iq/O/SXaTxftIZrx0iBaXGrYFh7e/iWkAZtIgxJJUiIn2JKIOtIiuXpxojBRVEQ1E/sej7FCiwbclmrFNkW8sTGmiFfg6cgUiSpiVagVmURFJA5vEL/8povGsQ/iF9WGRegnnGgtT4QjQvS2KH2ejcXoBx5oYtlsIvswd37RAe/x/DJ8opyimrF+prBFWKdECmCLEqxVZAybsUSIhqyNLVrxM1qEXm21OURFpOJnmv7471Q/4z0dvxKNZTMi9WO34HjmYUucC1xrRor0dmqj4mcyiIqoBoPjh0i8cgtEKSASrFn0Cqmuwdfqu2U4AAAAAElFTkSuQmCC) 66 66 stretch;
    border-style:solid;
}
.card-chinese p{ text-align:justify; color:#666; font-size:.875rem}

  /* ä¸»è‰²è°ƒï¼šæŸ”å’Œè“è‰² */
  :root {
    --primary-color: #244f3d; /* æŸ”å’Œè“è‰² */
    --secondary-color: #75d1ae; /* æµ…è“è‰²èƒŒæ™¯ */
    --card-bg: #ffffff;
    --text-muted: #666;
    --border-color: #ddd;
    --highlight-color: #ffc107;
  }

  h1, h2, h3, h4, h5, h6 {
    color: var(--primary-color);
    margin-bottom: 1rem;
  }

  .nav-tabs .nav-link {
    color: var(--primary-color);
    font-weight: 500;
    border: 1px solid var(--border-color);
    border-bottom-color:var(--primary-color);
  }

  .nav-tabs .nav-link.active {
    background-color: var(--secondary-color);
    color: var(--primary-color);
    border-color: var(--primary-color) var(--primary-color) var(--secondary-color);
  }

  .nav-tabs .nav-link:focus,
  .nav-tabs .nav-link:hover{
    border-bottom-color: var(--primary-color);
  }

  .nav-tabs .nav-link.active:focus,
  .nav-tabs .nav-link.active:hover{
    border-bottom-color: var(--secondary-color);
  }

  .justify-content-center{
    border-bottom-color: var(--primary-color);
  }

  .card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    transition: box-shadow 0.3s ease;
  }

  .card:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .card-text {
    font-size: 0.95rem;
    color: var(--text-muted);
  }

  .btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
    font-weight: 500;
    border-radius: 6px;
    padding: 0.4rem 1rem;
  }

  .btn-primary:hover {
    background-color: #3a75c0;
    border-color: #3a75c0;
  }

  .form-control {
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  .form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
  }

  /* é«˜äº®æ ·å¼ */
  mark {
    background-color: var(--highlight-color);
    padding: 0 2px;
    font-weight: bold;
    color: #333;
  }

  /* æ¸¸æˆé€‰é¡¹æŒ‰é’® */
  .option {
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
    display: inline-block;

    margin:0;
    padding:0;
  border-radius: 6px;
  border: 1px solid #ccc;
/*  width: calc(40% - 1rem); */
  min-height: 3.5rem; /* å›ºå®šæœ€å°é«˜åº¦ */
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  white-space: normal;
  word-wrap: break-word;
  text-align: left;
  }

  .option:hover {
    background-color: #f0f0f0;
    border-color: #aaa;
    color: #000;
  }
#check-toast {
  min-width: 240px;
  max-width: 320px;
  border: none;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18);
  /* é¿å…è¢«å…¶ä»–å…ƒç´ é®æŒ¡ */
  pointer-events: auto;
}

#toast-body {
  padding: 1rem;
  font-size: 1.05rem;
  line-height: 1.5;
  font-weight: 500;
}

#current-score, #best-score {
  font-size: 1.2rem;
  font-weight: bold;
}

.text-primary { color: #007bff; }
.text-danger { color: #dc3545; }

/* åˆ†é¡µæŒ‰é’®æ ·å¼ */
#pagination button {
    margin: 5px;
    padding: 10px;
    cursor: pointer;
}
#pagination button.active {
    background-color: lightblue;
}

/* éª¨æ¶å±å®¹å™¨ */

/* éª¨æ¶å…ƒç´ é€šç”¨æ ·å¼ */
.skeleton-title,
.skeleton-pinyin,
.skeleton-definition {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s infinite linear;
  border-radius: 4px;
}

.skeleton-title {
  width: 80px;
  height: 32px;
}

.skeleton-pinyin {
  width: 120px;
  height: 16px;
}

.skeleton-definition {
  width: 100%;
  height: 16px;
  max-width: 200px;
}

/* åŠ¨ç”»ï¼šæ¨¡æ‹ŸåŠ è½½å…‰æ‰«è¿‡çš„æ•ˆæœ */
@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* å…¨å±€åŠ è½½çŠ¶æ€ï¼šç¦ç”¨æ‰€æœ‰ç‚¹å‡» */
.loading-state {
  pointer-events: none;
  opacity: 0.75;
  transition: opacity 0.2s ease;
}

/* å¯é€‰ï¼šé¼ æ ‡æ ·å¼ */
.loading-state * {
  cursor: not-allowed !important;
}

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 768px) {
  .card-title {
    font-size: 1rem;
  }

  .card-text {
    font-size: 0.9rem;
  }
}
</style>
</head>
<body>

  <div id="app" class="container-lg py-4">
    <h1 class="text-center mb-5 mt-5">Cambridge IGCSE<br />ä¸­æ–‡æˆè¯­è¯å…¸</h1>

    <ul class="nav nav-tabs justify-content-center mb-4" id="myTabs">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#home">é¦–é¡µ</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#dictionary">æˆè¯­è¯å…¸</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#igcse">çœŸé¢˜æˆè¯­</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#game">æˆè¯­æŒ‘æˆ˜</a></li>
    </ul>

    <div class="tab-content" style="min-height: 400px;">

      <!-- é¦–é¡µ -->
      <div class="tab-pane fade show active" id="home">
        <h4 class="text-center mb-3">ä»Šæ—¥æˆè¯­</h4>

        <div class="card-chinese" style="max-width:900px">
          <p class="mb-0">ä¸­å›½çš„æˆè¯­æ‰¿è½½ç€æ·±åšçš„æ–‡åŒ–åº•è•´ï¼Œå†ç»åƒç™¾å¹´æ²‰æ·€ï¼Œåœ¨è·¨æ–‡åŒ–äº¤æµä¸­å±•ç°å‡ºå¼ºå¤§çš„è¡¨è¾¾åŠ›å’Œä¼ æ„åŠŸèƒ½ã€‚åœ¨ä¸­æ–‡èµ°å‘å›½é™…åŒ–çš„ä»Šå¤©ï¼Œæˆè¯­æ˜¯ä¸å¯æˆ–ç¼ºçš„æ–‡åŒ–æ¡¥æ¢ã€‚ä½œä¸ºä¸€åœºå›½é™…åŒ–çš„ä¸­æ–‡è€ƒè¯•ï¼Œå‰‘æ¡¥IGCSEä¸­æ–‡ç¬¬ä¸€è¯­è¨€ï¼ˆ0509ï¼‰çš„è€ƒè¯•å¤§çº²è¦æ±‚æˆ‘ä»¬æŒæ¡â€œæ°å½“ä½¿ç”¨è¯æ±‡â€å’Œâ€œæ¸…æ™°æœ‰æ•ˆä¼ è¾¾ä¿¡æ¯â€çš„èƒ½åŠ›ï¼Œè€Œæˆè¯­æ­£æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„æœ‰åŠ›å·¥å…·ã€‚è®©æˆ‘ä»¬ä»ä»Šå¤©å¼€å§‹ï¼Œæ¯å¤©ç§¯ç´¯ï¼Œè®©æˆè¯­ä¸ºæˆ‘ä»¬çš„è¡¨è¾¾å¢å…‰æ·»å½©ï¼</p>
        </div>

        <div id="random-idioms" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 mt-3">
          <!-- Skeleton Screen -->
          <div class="col">
            <div class="card h-100">
              <div class="card-body">
                <div class="skeleton-title"></div>
                <div class="skeleton-pinyin mt-2"></div>
                <div class="skeleton-definition mt-3"></div>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card h-100">
              <div class="card-body">
                <div class="skeleton-title"></div>
                <div class="skeleton-pinyin mt-2"></div>
                <div class="skeleton-definition mt-3"></div>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card h-100">
              <div class="card-body">
                <div class="skeleton-title"></div>
                <div class="skeleton-pinyin mt-2"></div>
                <div class="skeleton-definition mt-3"></div>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card h-100">
              <div class="card-body">
                <div class="skeleton-title"></div>
                <div class="skeleton-pinyin mt-2"></div>
                <div class="skeleton-definition mt-3"></div>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card h-100">
              <div class="card-body">
                <div class="skeleton-title"></div>
                <div class="skeleton-pinyin mt-2"></div>
                <div class="skeleton-definition mt-3"></div>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card h-100">
              <div class="card-body">
                <div class="skeleton-title"></div>
                <div class="skeleton-pinyin mt-2"></div>
                <div class="skeleton-definition mt-3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æˆè¯­è¯å…¸ -->
      <div class="tab-pane fade" id="dictionary">
        <h4 class="text-center mb-3">æŸ¥æˆè¯­</h4>

        <div class="card-chinese" style="max-width:900px">
          <p class="mb-0">æœ¬è¯å…¸æä¾›è¯è¯­ä¸è¯ä¹‰æ£€ç´¢åŠŸèƒ½ï¼Œå…±æ”¶å½•æˆè¯­è¿‘50000æ¡ï¼Œéƒ¨åˆ†æ•°æ®å·²é€šè¿‡äººå·¥æ ¸æŸ¥ä¸ä¿®æ­£ã€‚</p>
        </div>

        <div class="d-flex justify-content-center mb-3 mt-3">
          <form class="input-group input-group-lg" style="max-width:600px" onsubmit="return false;">
            <input id="search-input" type="text" class="form-control" placeholder="è¾“å…¥æˆè¯­æœç´¢..." aria-label="è¯·è¾“å…¥è¦æœç´¢çš„æˆè¯­ï¼Œè‡³å°‘2ä¸ªå­—ç¬¦" aria-describedby="button-addon2" minlength="2">
            <button class="btn btn-outline-dark" type="submit" id="button-addon2" onclick="searchIdiom()" disabled>æœç´¢</button>
          </form>
        </div>
        <div id="search-results" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 mt-3"></div>
      </div>

      <!-- IGCSEçœŸé¢˜ -->
      <div class="tab-pane fade" id="igcse">
        <h4 class="text-center mb-3">æ•™æå’ŒçœŸé¢˜ä¸­çš„æˆè¯­</h4>

        <div class="card-chinese" style="max-width:900px">
          <p class="mb-0">æ ¹æ®å¯¹å‰‘æ¡¥IGCSEä¸­æ–‡ç¬¬ä¸€è¯­è¨€ï¼ˆ0509ï¼‰å®˜æ–¹æ•™æåŠå†å¹´çœŸé¢˜ï¼ˆæˆªè‡³2025å¹´ï¼‰çš„ç»Ÿè®¡ï¼Œå…±å‡ºç°207æ¡æˆè¯­ï¼Œå…¶ä¸­ä»…5æ¡åå¤å‡ºç°ï¼Œç»å¤§å¤šæ•°æˆè¯­ä»…å‡ºç°ä¸€æ¬¡ã€‚è¿™è¯´æ˜è¯¾ç¨‹é¼“åŠ±æˆ‘ä»¬å¹¿æ³›ç§¯ç´¯ï¼Œä¸æ–­æ‹“å±•æˆè¯­è¯æ±‡é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä»…è¦æŒæ¡æˆè¯­çš„å­—é¢å«ä¹‰ï¼Œæ›´è¦ç†è§£å…¶åœ¨ç°ä»£è¯­å¢ƒä¸­çš„å®é™…ç”¨æ³•â€”â€”äº†è§£äººä»¬é€šå¸¸åœ¨ä»€ä¹ˆåœºåˆã€è¡¨è¾¾ä½•ç§æƒ…æ„Ÿæ—¶ä½¿ç”¨å®ƒã€‚åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£é¢†æ‚Ÿæˆè¯­èƒŒåçš„æ·±å±‚æ–‡åŒ–æ„æ¶µå’Œè¯­ç”¨åŠŸèƒ½ï¼Œç»§è€Œåœ¨é˜…è¯»ä¸­å‡†ç¡®æŠŠæ¡æ–‡æ„ï¼Œåœ¨å†™ä½œä¸­è‡ªç„¶ã€æ°å½“åœ°è¿ç”¨æˆè¯­ï¼Œåšåˆ°å¾—å¿ƒåº”æ‰‹ï¼Œæ¸¸åˆƒæœ‰ä½™ã€‚</p>
        </div>

        <div id="igcse-idioms" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 mt-3"></div>
        <nav aria-label="Page navigation example mt-5" class="mt-5" id="pagination"></nav>
        <div></div>
      </div>

      <!-- æˆè¯­æ¸¸æˆ -->
      <div class="tab-pane fade" id="game">
        <h4 class="text-center mb-3">50000æ¡æˆè¯­éšæœºæŒ‘æˆ˜</h4>

          <!-- è®¡åˆ†æ  -->

        <div class="card-chinese" style="max-width:900px">
          <div style="padding:1rem; text-align:center;">
            <span class="fs-5">å½“å‰å¾—åˆ†ï¼š</span>
            <strong id="current-score" class="text-primary fs-4">0</strong>
            <span class="mx-3">|</span>
            <span class="fs-5">æœ€é«˜åˆ†ï¼š</span>
            <strong id="best-score" class="text-danger fs-4">0</strong>
          </div>
        </div>

        <!-- æ¸¸æˆä¸»ä½“ -->
        <div id="game-container" class="text-center">
          <p id="question" class="lead mt-5"></p>
          <div id="options" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 mt-3"></div>
          <p class="mt-5">
            <button class="btn btn-outline-dark" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            <button class="btn btn-outline-secondary" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
          </p>
        </div>
      </div>
    </div>
    <p class="fs-6"><center class="card-text mt-5 ml-3 mr-3" style="font-size:.875rem">Copyright &copy; 2025 Mr. Z-Benjamin<br />æ•°æ®æ¥æºï¼šMapull Chinese-dictionary & å‰‘æ¡¥çœŸé¢˜</center></p>

  </div>
</div>

<!-- å±…ä¸­ Toast å®¹å™¨ -->
<div aria-live="polite" aria-atomic="true" class="position-fixed top-0 start-50 translate-middle-x" style="z-index: 1050;">
  <div id="check-toast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="2000">
    <div id="toast-body" class="d-flex align-items-center justify-content-center text-center"></div>
  </div>
</div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="./assets/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script>

    // è·å–æ ¹å®¹å™¨
    const appContainer = document.getElementById('app');

    // åˆå§‹åŒ–ï¼šè¿›å…¥åŠ è½½çŠ¶æ€
    appContainer.classList.add('loading-state');

    // å£°æ˜igcseæˆè¯­
    let igcseData = null;
    async function loadIgcseData() {
            try {
                // å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œè·å– JSON æ–‡ä»¶
                const response = await fetch('./dictionaries/idioms_cam.min.json');
                
                // æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ
                if (!response.ok) {
                    throw new Error(`HTTP é”™è¯¯ï¼çŠ¶æ€ç : ${response.status}`);
                }
                
                // å°†å“åº”ä½“è§£æä¸º JSON
                igcseData = await response.json();
                
                // âœ… æ•°æ®åŠ è½½æˆåŠŸï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨ igcseData äº†
                console.log("æ•°æ®åŠ è½½æˆåŠŸ:", igcseData);
                
                // åœ¨è¿™é‡Œè°ƒç”¨å…¶ä»–ä¾èµ– igcseData çš„å‡½æ•°
                // initializeApp(); 
                // displayData();
                
            } catch (error) {
                console.error("åŠ è½½æ•°æ®å¤±è´¥:", error);
                // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºé”™è¯¯æç¤ºç»™ç”¨æˆ·
                alert("æ— æ³•åŠ è½½æ•°æ®ï¼Œè¯·ç¨åé‡è¯•ã€‚");
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            loadIgcseData();
        });

    // å…¨éƒ¨æˆè¯­
    let allIdioms = [];

    // åŠ è½½ JSON æ•°æ®
    fetch('./dictionaries/idioms.min.json')
      .then(res => res.json())
      .then(data => {
        allIdioms = data;

        // æ•°æ®åŠ è½½æˆåŠŸï¼šç§»é™¤åŠ è½½çŠ¶æ€
        appContainer.classList.remove('loading-state');

        // æ¸²æŸ“é¡µé¢
        showHome();
        showIgcseIdioms();

        // ç›‘å¬ tab åˆ‡æ¢äº‹ä»¶ï¼Œè‡ªåŠ¨åŠ è½½æ¸¸æˆç¬¬ä¸€é¢˜
        const tabEl = document.querySelector('#myTabs a[href="#game"]');
        tabEl.addEventListener('shown.bs.tab', () => {
          nextQuestion();
        });
      })
      .catch(err => {
        console.error('æ•°æ®åŠ è½½å¤±è´¥:', err);
        // å³ä½¿å¤±è´¥ï¼Œä¹Ÿåº”æ¢å¤äº¤äº’ï¼ˆå¦åˆ™é¡µé¢å®Œå…¨ä¸å¯ç”¨ï¼‰
        appContainer.classList.remove('loading-state');
        const container = document.getElementById('random-idioms');
        container.innerHTML = '<p></p><p class="text-danger">åŠ è½½å¤±è´¥</p><p></p>';
      });

    // æ˜¾ç¤ºé¦–é¡µéšæœºæˆè¯­
    function showHome() {
      const container = document.getElementById('random-idioms');

      // å¦‚æœæ•°æ®æœªåŠ è½½ï¼Œç¡®ä¿éª¨æ¶å±å·²å­˜åœ¨ï¼ˆé€šå¸¸ HTML å·²å†™å¥½ï¼‰
      if (!allIdioms || allIdioms.length === 0) {
        // éª¨æ¶å±å·²åœ¨ HTML ä¸­ï¼Œæ— éœ€æ“ä½œ
        return;
      }

      // âœ… æ•°æ®å·²åŠ è½½ï¼šæ¸…ç©ºå®¹å™¨ï¼Œæ¸²æŸ“çœŸå®å†…å®¹
      container.innerHTML = ''; // ğŸ”¥ è‡ªåŠ¨ç§»é™¤éª¨æ¶å±

      // æ•°æ®å·²åŠ è½½ï¼Œç”Ÿæˆéšæœºæˆè¯­
      const randomIds = shuffle(allIdioms).slice(0, 6);
      container.innerHTML = '';
      randomIds.forEach(idiom => {
        renderCard(container, idiom.idiom, idiom.pinyin, idiom.definition);
      });
    }

    // æ¸²æŸ“å¡ç‰‡å‡½æ•°
    function renderCard(container, title, pinyin, content) {
      const col = document.createElement('div');
      col.className = 'col';
      col.innerHTML = `
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-4">${title}<br><small class="text-muted" style="font-family:Helvetica, Arial, sans-serif">${pinyin}</small></h5>
            <p class="card-text mt-auto">${content}</p>
          </div>
        </div>
      `;
      container.appendChild(col);
    }

    // é«˜äº®å…³é”®è¯å‡½æ•°
    function highlightText(text, keyword) {
      if (!keyword || !text) return text;

      const escapeRegExp = (s) => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const pattern = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
      return text.replace(pattern, '<mark>$1</mark>');
    }

    // æœç´¢æˆè¯­
    // ç›‘å¬æœç´¢æ¡†è‡³å°‘è¾“å…¥ä¸¤ä¸ªå­—ç¬¦
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('button-addon2');

    // ç›‘å¬è¾“å…¥æ¡†å†…å®¹å˜åŒ–
    searchInput.addEventListener('input', function () {
      const query = this.value.trim(); // å»é™¤é¦–å°¾ç©ºæ ¼

      // å¦‚æœè¾“å…¥å­—ç¬¦æ•° >= 2ï¼Œå¯ç”¨æŒ‰é’®ï¼›å¦åˆ™ç¦ç”¨
      if (query.length >= 2) {
        searchBtn.disabled = false;
      } else {
        searchBtn.disabled = true;
      }
    });

    // å¯é€‰ï¼šé¡µé¢åŠ è½½æ—¶ç¡®ä¿æŒ‰é’®åˆå§‹çŠ¶æ€
    searchBtn.disabled = true;

    function searchIdiom() {
      const input = document.getElementById('search-input').value.trim();
      const results = allIdioms.filter(idiom =>
        // ç¡®ä¿ idiom.definition å­˜åœ¨ä¸”ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå†è°ƒç”¨ toLowerCase å’Œ includes
        idiom.idiom && idiom.idiom.toLowerCase().includes(input.toLowerCase()) ||
        (idiom.definition && typeof idiom.definition === 'string' && idiom.definition.toLowerCase().includes(input.toLowerCase()))
      );
      const container = document.getElementById('search-results');
      container.innerHTML = '';

      if (results.length === 0) {
        container.innerHTML = '<p></p><p class="text-muted text-center">æœªæ‰¾åˆ°ç›¸å…³æˆè¯­ã€‚</p><p></p>';
      } else {
        results.forEach(idiom => {
          const highlightedIdiom = highlightText(idiom.idiom, input);
          const highlightedDef = highlightText(idiom.definition, input);

          renderCard(container, highlightedIdiom, idiom.pinyin, highlightedDef);
        });
      }
    }

    // æ˜¾ç¤º IGCSE æˆè¯­
    // å…¨å±€å˜é‡ç”¨äºå­˜å‚¨å½“å‰é¡µç 
    let currentPage = 1;
    const pageSize = 6; // æ¯é¡µæ˜¾ç¤ºçš„æˆè¯­æ•°é‡

    function showIgcseIdioms() {
      const container = document.getElementById('igcse-idioms');
      container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨

      // 1. è·å–æ‰€æœ‰æ¡ç›®å¹¶è½¬æ¢ä¸ºæ•°ç»„
      const entries = Object.entries(igcseData);

      // 2. æŒ‰ examï¼ˆå³æ–‡ä»¶åï¼‰å€’åºæ’åº
      entries.sort((a, b) => {
        const examA = a[0];
        const examB = b[0];
        return examB.localeCompare(examA, 'en', { numeric: true, sensitivity: 'base' });
      });

      // 3. è®¡ç®—æ€»æ¡ç›®æ•°
      let allItems = [];
      entries.forEach(([exam, idiomToExampleMap]) => {
        Object.entries(idiomToExampleMap).forEach(([idiomName, exampleSentence]) => {
          const item = allIdioms.find(i => i.idiom === idiomName);
          if (item) {
            allItems.push({
              idiom: item.idiom,
              pinyin: item.pinyin,
              definition: item.definition,
              exampleSentence: `${exampleSentence} (${exam})`
            });
          }
        });
      });

      // 4. è®¡ç®—æ€»é¡µæ•°
      const totalPages = Math.ceil(allItems.length / pageSize);

      // è·å–å½“å‰é¡µçš„æˆè¯­æ•°æ®
      const startIdx = (currentPage - 1) * pageSize;
      const endIdx = startIdx + pageSize;
      const currentItems = allItems.slice(startIdx, endIdx);

      // æ¸²æŸ“å½“å‰é¡µçš„æˆè¯­å¡ç‰‡
      currentItems.forEach(item => {
        renderCard(
          container,
          item.idiom,
          item.pinyin,
          `<strong>è¾å…¸é‡Šä¹‰ï¼š</strong>${item.definition}<br /><strong>å®˜æ–¹ä¾‹å¥ï¼š</strong>${item.exampleSentence}`
        );
      });

      // æ¸²æŸ“åˆ†é¡µæ§ä»¶
      renderPagination(totalPages);
    }

    // æ¸²æŸ“åˆ†é¡µæ§ä»¶ï¼ˆä½¿ç”¨ Bootstrapï¼Œç¦ç”¨æŒ‰é’®ï¼‰
    function renderPagination(totalPages) {
      const paginationContainer = document.getElementById('pagination');
      
      // æ¸…ç©ºå¹¶ç”Ÿæˆåˆ†é¡µ HTMLï¼ˆä¸åŒ…å« onclickï¼‰
      let html = `
        <ul class="pagination justify-content-center" id="pagination-controls">
      `;

      // ä¸Šä¸€é¡µ
      if (currentPage > 1) {
        html += `<li class="page-item"><a class="page-link" data-page="${currentPage - 1}" href="###">ä¸Šä¸€é¡µ</a></li>`;
      }

      // é¡µç æŒ‰é’®
      const maxButtons = 5;
      let startPage, endPage;

      if (totalPages <= maxButtons) {
        startPage = 1;
        endPage = totalPages;
      } else {
        const half = Math.floor(maxButtons / 2);
        if (currentPage <= half) {
          startPage = 1;
          endPage = maxButtons;
        } else if (currentPage + half >= totalPages) {
          startPage = totalPages - maxButtons + 1;
          endPage = totalPages;
        } else {
          startPage = currentPage - half;
          endPage = currentPage + half;
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        const btnClass = i === currentPage ? 'active' : '';
        html += `<li class="page-item ${btnClass}"><a class="page-link" data-page="${i}" href="###">${i}</a></li>`;
      }

      // ä¸‹ä¸€é¡µ
      if (currentPage < totalPages) {
        html += `<li class="page-item"><a class="page-link" data-page="${currentPage + 1}" href="###">ä¸‹ä¸€é¡µ</a></li>`;
      }

      html += `</ul>`;
      paginationContainer.innerHTML = html;

      // âœ… ä½¿ç”¨äº‹ä»¶å§”æ‰˜ç»‘å®šç‚¹å‡»äº‹ä»¶
      const controls = document.getElementById('pagination-controls');
      controls.addEventListener('click', function(e) {
        if (e.target.tagName === 'A') {
          const page = parseInt(e.target.dataset.page); // ä» data-page è·å–ç›®æ ‡é¡µç 
          if (!isNaN(page)) {
            goToPage(page); // è°ƒç”¨è·³è½¬å‡½æ•°
          }
        }
      });
    }

    // ç”Ÿæˆé¡µç æŒ‰é’®çš„ HTML å­—ç¬¦ä¸²
    function generatePageButtons(currentPage, totalPages) {
      let buttonsHTML = '';

      // æ˜¾ç¤ºé€»è¾‘ï¼šæœ€å¤šæ˜¾ç¤º 7 ä¸ªé¡µç æŒ‰é’®ï¼ˆå¯è°ƒæ•´ï¼‰
      const maxButtons = 7;
      let startPage, endPage;

      if (totalPages <= maxButtons) {
        // æ€»é¡µæ•°å°‘ï¼Œæ˜¾ç¤ºå…¨éƒ¨
        startPage = 1;
        endPage = totalPages;
      } else {
        // æ€»é¡µæ•°å¤šï¼Œå±…ä¸­å½“å‰é¡µ
        const half = Math.floor(maxButtons / 2);
        if (currentPage <= half) {
          startPage = 1;
          endPage = maxButtons;
        } else if (currentPage + half >= totalPages) {
          startPage = totalPages - maxButtons + 1;
          endPage = totalPages;
        } else {
          startPage = currentPage - half;
          endPage = currentPage + half;
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        buttonsHTML += `
          <li class="page-item ${i === currentPage ? '' : 'active'}"><a class="page-link" data-page="${currentPage + 1}" href="#" onclick="goToPage(${i})">${i}</a></li>
        `;
      }

      return buttonsHTML;
    }

    // è·³è½¬åˆ°æŒ‡å®šé¡µç çš„å‡½æ•°
    function goToPage(page) {
      // é‡æ–°è®¡ç®—æ€»é¡µæ•°ï¼ˆåŸºäºå½“å‰ igcseData æ•°æ®æ€»é‡ï¼‰
      const totalItems = Object.entries(igcseData).reduce(
        (acc, [exam, map]) => acc + Object.keys(map).length,
        0
      );
      const totalPages = Math.ceil(totalItems / 6);

      // âœ… å®‰å…¨æ£€æŸ¥ï¼špage å¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œä¸”åœ¨èŒƒå›´å†…ï¼Œä¸”ä¸æ˜¯å½“å‰é¡µ
      if (Number.isInteger(page) && page >= 1 && page <= totalPages && page !== currentPage) {
        currentPage = page;
        showIgcseIdioms(); // é‡æ–°æ¸²æŸ“æˆè¯­åˆ—è¡¨
      }
      // å¦åˆ™ï¼šæ— æ•ˆç‚¹å‡»ï¼Œé™é»˜å¿½ç•¥
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    let currentQuestion = null;

    function nextQuestion() {
      // éšæœºé€‰æ‹©ä¸€ä¸ªæˆè¯­ä½œä¸ºæ­£ç¡®ç­”æ¡ˆ
      const randomIdiom = allIdioms[Math.floor(Math.random() * allIdioms.length)];
      
      // æ­£ç¡®é€‰é¡¹æ˜¯æˆè¯­å
      let options = [randomIdiom.idiom];

      // æ·»åŠ å…¶ä»– 2 ä¸ªå¹²æ‰°é¡¹ï¼ˆå…¶ä»–æˆè¯­çš„åå­—ï¼‰
      while (options.length < 3) {
        const candidate = allIdioms[Math.floor(Math.random() * allIdioms.length)].idiom;
        if (!options.includes(candidate)) {
          options.push(candidate);
        }
      }

      // æ‰“ä¹±é€‰é¡¹é¡ºåº
      options = shuffle(options);

      // è®°å½•æ­£ç¡®ç­”æ¡ˆçš„æ–°ä½ç½®
      currentQuestion = {
        definition: randomIdiom.definition, // å½“å‰é‡Šä¹‰
        correctIndex: options.indexOf(randomIdiom.idiom) // æˆè¯­åœ¨æ‰“ä¹±åçš„ä½ç½®
      };

      // æ˜¾ç¤ºé—®é¢˜ï¼šæ ¹æ®é‡Šä¹‰çŒœæˆè¯­
      document.getElementById('question').innerHTML = `<strong style="border-bottom:#333 1px dashed">â€œ${randomIdiom.definition}â€ å¯¹åº”çš„æˆè¯­æ˜¯ï¼Ÿ</strong>`;

      // æ¸²æŸ“é€‰é¡¹æŒ‰é’®ï¼ˆæ˜¾ç¤ºæˆè¯­åï¼‰
      document.getElementById('options').innerHTML = options.map((idiom, index) => {
        // æŸ¥æ‰¾è¯¥æˆè¯­çš„æ‹¼éŸ³ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
        const item = allIdioms.find(i => i.idiom === idiom);
        const pinyin = item ? item.pinyin : 'æœªçŸ¥æ‹¼éŸ³';

        return `
          <div class="col">
            <button class="btn btn-outline-dark option card h-100" onclick="checkAnswer(${index})">
              <span class="card-body d-flex flex-column text-center" style="justify-content: center; line-height:1.2">
                <span class="card-title mb-0">${idiom}<br /><small class="text-muted">${pinyin}</small></span>
              </span>
            </button>
          </div>
        `;
      }).join('');

    }

    function checkAnswer(index) {
      if (!currentQuestion) return;
      const toastEl = document.getElementById('check-toast');
      const toastBody = document.getElementById('toast-body');
      const toast = bootstrap.Toast.getInstance(toastEl) || new bootstrap.Toast(toastEl);

      const isCorrect = index === currentQuestion.correctIndex;

      if (isCorrect) {
        // ç­”å¯¹ï¼šåŠ  10 åˆ†
        currentScore += 10;
        document.getElementById('current-score').textContent = currentScore;

        // æ›´æ–°æœ€é«˜åˆ†ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (currentScore > bestScore) {
          bestScore = currentScore;
          document.getElementById('best-score').textContent = bestScore;
          localStorage.setItem('idiomGameBestScore', bestScore);
        }

        // æ˜¾ç¤º Toast
        toastEl.classList.remove('bg-danger', 'text-white');
        toastEl.classList.add('bg-success', 'text-white');
        toastBody.innerHTML = 'æ­£ç¡®ï¼+10 åˆ†';

        // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
        setTimeout(() => {
          nextQuestion();
        }, 300);
      } else {
        // ç­”é”™ï¼šä¸åŠ åˆ†
        toastEl.classList.remove('bg-success', 'text-white');
        toastEl.classList.add('bg-danger', 'text-white');
        toastBody.innerHTML = `é”™è¯¯ã€‚`;
      }

      // æ˜¾ç¤º Toast
      toast.hide();
      toast.show();
    }

    // è¾…åŠ©å‡½æ•°ï¼šæ´—ç‰Œ
    function shuffle(array) {
      return [...array].sort(() => Math.random() - 0.5);
    }

    // è®¡åˆ†å˜é‡
    let currentScore = 0;
    let bestScore = parseInt(localStorage.getItem('idiomGameBestScore')) || 0;

    // é¡µé¢åŠ è½½åæ˜¾ç¤ºæœ€é«˜åˆ†
    document.addEventListener('DOMContentLoaded', () => {
      const bestScoreEl = document.getElementById('best-score');
      if (bestScoreEl) {
        bestScoreEl.textContent = bestScore;
      }
    });
    function restartGame() {
      currentScore = 0;
      document.getElementById('current-score').textContent = currentScore;
      nextQuestion();
    }
  </script>
</body>
</html>